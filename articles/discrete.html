<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>odin discrete models • odin</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="odin discrete models">
<meta property="og:description" content="odin">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">odin</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/odin.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/debugging.html">debugging</a>
    </li>
    <li>
      <a href="../articles/discrete.html">odin discrete models</a>
    </li>
    <li>
      <a href="../articles/functions.html">odin functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/odin/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>odin discrete models</h1>
                        <h4 data-toc-skip class="author">Thibaut
Jombart, Rich FitzJohn</h4>
            
            <h4 data-toc-skip class="date">2023-06-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/odin/blob/HEAD/vignettes/discrete.Rmd" class="external-link"><code>vignettes/discrete.Rmd</code></a></small>
      <div class="hidden name"><code>discrete.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="discrete-compartmental-models-in-a-nutshell">Discrete compartmental models in a nutshell<a class="anchor" aria-label="anchor" href="#discrete-compartmental-models-in-a-nutshell"></a>
</h2>
<div class="section level3">
<h3 id="from-continuous-to-discrete-time">From continuous to discrete time<a class="anchor" aria-label="anchor" href="#from-continuous-to-discrete-time"></a>
</h3>
<p>In its simplest form, a SIR model is typically written in continuous
time as:</p>
<p><span class="math display">\[
\frac{dS}{dt} = - \beta \frac{S_t I_t}{N_t}
\]</span></p>
<p><span class="math display">\[
\frac{dI}{dt} = \beta \frac{S_t I_t}{N_t} - \gamma I_t
\]</span></p>
<p><span class="math display">\[
\frac{dR}{dt} = \gamma I_t
\]</span></p>
<p>Where <span class="math inline">\(\beta\)</span> is an infection rate
and <span class="math inline">\(\gamma\)</span> a removal rate, assuming
‘R’ stands for ‘recovered’, which can mean recovery or death.</p>
<p>For discrete time equivalent, we take a small time step <span class="math inline">\(t\)</span> (typically a day), and write the
changes of individuals in each compartment as:</p>
<p><span class="math display">\[
S_{t+1} = S_t - \beta \frac{S_t I_t}{N_t}
\]</span></p>
<p><span class="math display">\[
I_{t+1} = I_t + \beta \frac{S_t I_t}{N_t} - \gamma I_t
\]</span></p>
<p><span class="math display">\[
R_{t+1} = R_t + \gamma I_t
\]</span></p>
</div>
<div class="section level3">
<h3 id="stochastic-processes">Stochastic processes<a class="anchor" aria-label="anchor" href="#stochastic-processes"></a>
</h3>
<p>The discrete model above remains deterministic: for given values of
the rates <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span>, dynamics will be fixed. It is
fairly straightforward to convert this discrete model into a stochastic
one: one merely needs to uses appropriate probability distributions to
model the transfer of individuals across compartments. There are at
least 3 types of such distributions which will be useful to
consider.</p>
<div class="section level4">
<h4 id="binomial-distribution">Binomial distribution<a class="anchor" aria-label="anchor" href="#binomial-distribution"></a>
</h4>
<p>This distribution will be used to determine numbers of individuals
<strong>leaving</strong> a given compartment. While we may be tempted to
use a Poisson distribution with the rates specified in the equations
above, this could lead to over-shooting, i.e. more individuals leaving a
compartment than there actually are. To avoid infecting more people than
there are susceptibles, we use a binomial distribution, with one draw
for each individual in the compartment of interest. The workflow will
be:</p>
<ol style="list-style-type: decimal">
<li><p>determine a <em>per-capita probability</em> of leaving the
compartment, based on the original rates specified in the equations; if
the rate at which each individual leaves a compartment is <span class="math inline">\(\lambda\)</span>, then the corresponding
probability of this individual leaving the compartment in one time unit
is <span class="math inline">\(p = 1 - e^{- \lambda}\)</span>.</p></li>
<li><p>determine the number of individuals leaving the compartment using
a <em>Binomial</em> distribution, with one draw per individual and a
probability <span class="math inline">\(p\)</span></p></li>
</ol>
<p>As an example, let us consider transition <span class="math inline">\(S \rightarrow I\)</span> in the SIR model. The
overall rate at which this change happens is <span class="math inline">\(\beta \frac{S_t I_t}{N_t}\)</span>. The
corresponding <em>per susceptible</em> rate is <span class="math inline">\(\beta \frac{I_t}{N_t}\)</span>. Therefore, the
probability for an individual to move from <em>S</em> to <em>I</em> at
time <span class="math inline">\(t\)</span> is <span class="math inline">\(p_{(S \rightarrow I), t} = 1 - e^{- \beta
\frac{I_t}{N_t}}\)</span>.</p>
</div>
<div class="section level4">
<h4 id="poisson-distribution">Poisson distribution<a class="anchor" aria-label="anchor" href="#poisson-distribution"></a>
</h4>
<p>Poisson distributions will be useful when individuals enter a
compartment at a given rate, from ‘the outside’. This could be birth or
migration (for <span class="math inline">\(S\)</span>), or introduction
of infections from an external reservoir (for <span class="math inline">\(I\)</span>), etc. The essential distinction with
the previous process is that individuals are <em>not leaving</em> an
existing compartment.</p>
<p>This case is simple to handle: one just needs to draw new individuals
entering the compartment from a Poisson distribution with the rate
directly coming from the equations.</p>
<p>For instance, let us now consider a variant of the SIR model where
new infectious cases are imported at a constant rate <span class="math inline">\(\epsilon\)</span>. The only change to the equation
is for the infected compartment:</p>
<p><span class="math display">\[
I_{t+1} = I_t + \beta \frac{S_t I_t}{N_t} + \epsilon - \gamma I_t
\]</span></p>
<p>where:</p>
<ul>
<li><p>individuals move from <span class="math inline">\(S\)</span> to
<span class="math inline">\(I\)</span> according to a Binomial
distribution <span class="math inline">\(\mathcal{B}(S_t, 1 - e^{- \beta
\frac{I_t}{N_t}})\)</span></p></li>
<li><p>new infected individuals are imported according to a Poisson
distribution <span class="math inline">\(\mathcal{P}(\epsilon)\)</span></p></li>
<li><p>individual move from <span class="math inline">\(I\)</span> to
<span class="math inline">\(R\)</span> according to a Binomial
distribution <span class="math inline">\(\mathcal{B}(I_t, 1 - e^{-
\gamma})\)</span></p></li>
</ul>
</div>
<div class="section level4">
<h4 id="multinomial-distribution">Multinomial distribution<a class="anchor" aria-label="anchor" href="#multinomial-distribution"></a>
</h4>
<p>This distribution will be useful when individuals leaving a
compartment are distributed over several compartments. The Multinomial
distribution will be used to determine how many individuals end up in
each compartment. Let us assume that individuals move from a compartment
<span class="math inline">\(X\)</span> to compartments <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, and <span class="math inline">\(C\)</span>, at rates <span class="math inline">\(\lambda_A\)</span>, <span class="math inline">\(\lambda_B\)</span> and <span class="math inline">\(\lambda_C\)</span>. The workflow to handle these
transitions will be:</p>
<ol style="list-style-type: decimal">
<li><p>determine the total number of individuals leaving <span class="math inline">\(X\)</span>; this is done by summing the rates
(<span class="math inline">\(\lambda = \lambda_A + \lambda_B +
\lambda_C\)</span>) to compute the <em>per capita</em> probability of
leaving <span class="math inline">\(X\)</span> <span class="math inline">\((p_(X \rightarrow ...) = 1 - e^{-
\lambda})\)</span>, and drawing the number of individuals leaving <span class="math inline">\(X\)</span> (<span class="math inline">\(n_{_(X
\rightarrow ...)}\)</span>) from a binomial distribution <span class="math inline">\(n_{(X \rightarrow ...)} \sim B(X, p_(X \rightarrow
...))\)</span></p></li>
<li><p>compute relative probabilities of moving to the different
compartments (using <span class="math inline">\(i\)</span> as a
placeholder for <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, <span class="math inline">\(C\)</span>): <span class="math inline">\(p_i =
\frac{\lambda_i}{\sum_i \lambda_i}\)</span></p></li>
<li><p>determine the numbers of individuals moving to <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>
and <span class="math inline">\(C\)</span> using a Multinomial
distribution: <span class="math inline">\(n_{(X \rightarrow A, B, C)}
\sim \mathcal{M}(n_{(X \rightarrow ...)}, p_A, p_B,
p_C)\)</span></p></li>
</ol>
</div>
</div>
</div>
<div class="section level2">
<h2 id="implementation-using-odin">Implementation using <code>odin</code><a class="anchor" aria-label="anchor" href="#implementation-using-odin"></a>
</h2>
<div class="section level3">
<h3 id="deterministic-sir-model">Deterministic SIR model<a class="anchor" aria-label="anchor" href="#deterministic-sir-model"></a>
</h3>
<p>We start by loading the <code>odin</code> code for a discrete,
stochastic SIR model:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_sir_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/discrete_deterministic_sir.R"</span>,</span>
<span>                              package <span class="op">=</span> <span class="st">"odin"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Core equations for transitions between compartments:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op">-</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">S</span> <span class="op">*</span> <span class="va">I</span> <span class="op">/</span> <span class="va">N</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">I</span> <span class="op">+</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">S</span> <span class="op">*</span> <span class="va">I</span> <span class="op">/</span> <span class="va">N</span> <span class="op">-</span> <span class="va">gamma</span> <span class="op">*</span> <span class="va">I</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">R</span> <span class="op">+</span> <span class="va">gamma</span> <span class="op">*</span> <span class="va">I</span></span>
<span></span>
<span><span class="co">## Total population size (odin will recompute this at each timestep:</span></span>
<span><span class="co">## automatically)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op">+</span> <span class="va">I</span> <span class="op">+</span> <span class="va">R</span></span>
<span></span>
<span><span class="co">## Initial states:</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">S_ini</span> <span class="co"># will be user-defined</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">I</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">I_ini</span> <span class="co"># will be user-defined</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co">## User defined parameters - default in parentheses:</span></span>
<span><span class="va">S_ini</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">I_ini</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>As said in the previous vignette, remember this looks and parses like
R code, but is not actually R code. Copy-pasting this in a R session
will trigger errors.</p>
<p>We then use <code>odin</code> to compile this model:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_generator</span> <span class="op">&lt;-</span> <span class="fu">odin</span><span class="fu">::</span><span class="fu"><a href="../reference/odin.html">odin</a></span><span class="op">(</span><span class="va">path_sir_model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required namespace: pkgbuild</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_generator</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;odin_model&gt; object generator</span></span>
<span><span class="co">##   Public:</span></span>
<span><span class="co">##     initialize: function (..., user = list(...), use_dde = FALSE, unused_user_action = NULL) </span></span>
<span><span class="co">##     ir: function () </span></span>
<span><span class="co">##     set_user: function (..., user = list(...), unused_user_action = NULL) </span></span>
<span><span class="co">##     initial: function (step) </span></span>
<span><span class="co">##     rhs: function (step, y) </span></span>
<span><span class="co">##     update: function (step, y) </span></span>
<span><span class="co">##     contents: function () </span></span>
<span><span class="co">##     transform_variables: function (y) </span></span>
<span><span class="co">##     engine: function () </span></span>
<span><span class="co">##     run: function (step, y = NULL, ..., use_names = TRUE) </span></span>
<span><span class="co">##   Private:</span></span>
<span><span class="co">##     ptr: NULL</span></span>
<span><span class="co">##     use_dde: NULL</span></span>
<span><span class="co">##     odin: NULL</span></span>
<span><span class="co">##     variable_order: NULL</span></span>
<span><span class="co">##     output_order: NULL</span></span>
<span><span class="co">##     n_out: NULL</span></span>
<span><span class="co">##     ynames: NULL</span></span>
<span><span class="co">##     interpolate_t: NULL</span></span>
<span><span class="co">##     cfuns: list</span></span>
<span><span class="co">##     dll: discrete.deterministic.sircae35f1d</span></span>
<span><span class="co">##     user: beta gamma I_ini S_ini</span></span>
<span><span class="co">##     registration: function () </span></span>
<span><span class="co">##     set_initial: function (step, y, use_dde) </span></span>
<span><span class="co">##     update_metadata: function () </span></span>
<span><span class="co">##   Parent env: &lt;environment: namespace:discrete.deterministic.sircae35f1d&gt;</span></span>
<span><span class="co">##   Locked objects: TRUE</span></span>
<span><span class="co">##   Locked class: FALSE</span></span>
<span><span class="co">##   Portable: TRUE</span></span></code></pre>
<p><strong>Note</strong>: this is the slow part (generation and then
compilation of C code)! Which means for computer-intensive work, the
number of times this is done should be minimized.</p>
<p>The returned object <code>sir_generator</code>is an R6 generator that
can be used to create an instance of the model: generate an instance of
the model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">sir_generator</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;odin_model&gt;</span></span>
<span><span class="co">##   Public:</span></span>
<span><span class="co">##     contents: function () </span></span>
<span><span class="co">##     engine: function () </span></span>
<span><span class="co">##     initial: function (step) </span></span>
<span><span class="co">##     initialize: function (..., user = list(...), use_dde = FALSE, unused_user_action = NULL) </span></span>
<span><span class="co">##     ir: function () </span></span>
<span><span class="co">##     rhs: function (step, y) </span></span>
<span><span class="co">##     run: function (step, y = NULL, ..., use_names = TRUE) </span></span>
<span><span class="co">##     set_user: function (..., user = list(...), unused_user_action = NULL) </span></span>
<span><span class="co">##     transform_variables: function (y) </span></span>
<span><span class="co">##     update: function (step, y) </span></span>
<span><span class="co">##   Private:</span></span>
<span><span class="co">##     cfuns: list</span></span>
<span><span class="co">##     dll: discrete.deterministic.sircae35f1d</span></span>
<span><span class="co">##     interpolate_t: NULL</span></span>
<span><span class="co">##     n_out: 0</span></span>
<span><span class="co">##     odin: environment</span></span>
<span><span class="co">##     output_order: NULL</span></span>
<span><span class="co">##     ptr: externalptr</span></span>
<span><span class="co">##     registration: function () </span></span>
<span><span class="co">##     set_initial: function (step, y, use_dde) </span></span>
<span><span class="co">##     update_metadata: function () </span></span>
<span><span class="co">##     use_dde: FALSE</span></span>
<span><span class="co">##     user: beta gamma I_ini S_ini</span></span>
<span><span class="co">##     variable_order: list</span></span>
<span><span class="co">##     ynames: step S I R</span></span></code></pre>
<p><code>x</code> is an <code>ode_model</code> object which can be used
to generate dynamics of a discrete-time, deterministic SIR model. This
is achieved using the function <code>x$run()</code>, providing time
steps as single argument, e.g.:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#8c8cd9"</span>, <span class="st">"#cc0044"</span>, <span class="st">"#999966"</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       step         S        I         R</span></span>
<span><span class="co">##  [1,]    0 1000.0000 1.000000 0.0000000</span></span>
<span><span class="co">##  [2,]    1  999.8002 1.099800 0.1000000</span></span>
<span><span class="co">##  [3,]    2  999.5805 1.209517 0.2099800</span></span>
<span><span class="co">##  [4,]    3  999.3389 1.330125 0.3309317</span></span>
<span><span class="co">##  [5,]    4  999.0734 1.462696 0.4639442</span></span>
<span><span class="co">##  [6,]    5  998.7814 1.608403 0.6102138</span></span>
<span><span class="co">##  [7,]    6  998.4604 1.768530 0.7710541</span></span>
<span><span class="co">##  [8,]    7  998.1076 1.944486 0.9479071</span></span>
<span><span class="co">##  [9,]    8  997.7198 2.137811 1.1423557</span></span>
<span><span class="co">## [10,]    9  997.2937 2.350191 1.3561368</span></span>
<span><span class="co">## [11,]   10  996.8254 2.583469 1.5911558</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_res</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.1</span>, <span class="fl">5.1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">x_res</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">x_res</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Number of individuals"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="va">sir_col</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, lwd <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">sir_col</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="discrete_files/figure-html/sir-deterministic-1.png" alt="&lt;i&gt;An example of deterministic, discrete-time SIR model&lt;/i&gt;&lt;br&gt;" width="672"><p class="caption">
<i>An example of deterministic, discrete-time SIR model</i><br></p>
</div>
</div>
<div class="section level3">
<h3 id="stochastic-sir-model">Stochastic SIR model<a class="anchor" aria-label="anchor" href="#stochastic-sir-model"></a>
</h3>
<p>The stochastic equivalent of the previous model can be formulated in
<code>odin</code> as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_sir_model_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/discrete_stochastic_sir.R"</span>,</span>
<span>                                package <span class="op">=</span> <span class="st">"odin"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Core equations for transitions between compartments:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op">-</span> <span class="va">n_SI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">I</span> <span class="op">+</span> <span class="va">n_SI</span> <span class="op">-</span> <span class="va">n_IR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">R</span> <span class="op">+</span> <span class="va">n_IR</span></span>
<span></span>
<span><span class="co">## Individual probabilities of transition:</span></span>
<span><span class="va">p_SI</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta</span> <span class="op">*</span> <span class="va">I</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span> <span class="co"># S to I</span></span>
<span><span class="va">p_IR</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">gamma</span><span class="op">)</span> <span class="co"># I to R</span></span>
<span></span>
<span><span class="co">## Draws from binomial distributions for numbers changing between</span></span>
<span><span class="co">## compartments:</span></span>
<span><span class="va">n_SI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">p_SI</span><span class="op">)</span></span>
<span><span class="va">n_IR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">I</span>, <span class="va">p_IR</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Total population size</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op">+</span> <span class="va">I</span> <span class="op">+</span> <span class="va">R</span></span>
<span></span>
<span><span class="co">## Initial states:</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">S_ini</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">I</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">I_ini</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co">## User defined parameters - default in parentheses:</span></span>
<span><span class="va">S_ini</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">I_ini</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>We can use the same workflow as before to run the model, using 10
initial infected individuals (<code>I_ini = 10</code>):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_s_generator</span> <span class="op">&lt;-</span> <span class="fu">odin</span><span class="fu">::</span><span class="fu"><a href="../reference/odin.html">odin</a></span><span class="op">(</span><span class="va">path_sir_model_s</span><span class="op">)</span></span>
<span><span class="va">sir_s_generator</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;odin_model&gt; object generator</span></span>
<span><span class="co">##   Public:</span></span>
<span><span class="co">##     initialize: function (..., user = list(...), use_dde = FALSE, unused_user_action = NULL) </span></span>
<span><span class="co">##     ir: function () </span></span>
<span><span class="co">##     set_user: function (..., user = list(...), unused_user_action = NULL) </span></span>
<span><span class="co">##     initial: function (step) </span></span>
<span><span class="co">##     rhs: function (step, y) </span></span>
<span><span class="co">##     update: function (step, y) </span></span>
<span><span class="co">##     contents: function () </span></span>
<span><span class="co">##     transform_variables: function (y) </span></span>
<span><span class="co">##     engine: function () </span></span>
<span><span class="co">##     run: function (step, y = NULL, ..., use_names = TRUE) </span></span>
<span><span class="co">##   Private:</span></span>
<span><span class="co">##     ptr: NULL</span></span>
<span><span class="co">##     use_dde: NULL</span></span>
<span><span class="co">##     odin: NULL</span></span>
<span><span class="co">##     variable_order: NULL</span></span>
<span><span class="co">##     output_order: NULL</span></span>
<span><span class="co">##     n_out: NULL</span></span>
<span><span class="co">##     ynames: NULL</span></span>
<span><span class="co">##     interpolate_t: NULL</span></span>
<span><span class="co">##     cfuns: list</span></span>
<span><span class="co">##     dll: discrete.stochastic.sir0da50947</span></span>
<span><span class="co">##     user: beta gamma I_ini S_ini</span></span>
<span><span class="co">##     registration: function () </span></span>
<span><span class="co">##     set_initial: function (step, y, use_dde) </span></span>
<span><span class="co">##     update_metadata: function () </span></span>
<span><span class="co">##   Parent env: &lt;environment: namespace:discrete.stochastic.sir0da50947&gt;</span></span>
<span><span class="co">##   Locked objects: TRUE</span></span>
<span><span class="co">##   Locked class: FALSE</span></span>
<span><span class="co">##   Portable: TRUE</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">sir_s_generator</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>I_ini <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x_res</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.1</span>, <span class="fl">5.1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">x_res</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">x_res</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Number of individuals"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="va">sir_col</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, lwd <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">sir_col</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="discrete_files/figure-html/sir-stochastic_1-1.png" alt="&lt;i&gt;An example of stochastic, discrete-time SIR model&lt;/i&gt;&lt;br&gt;" width="672"><p class="caption">
<i>An example of stochastic, discrete-time SIR model</i><br></p>
</div>
<p>This gives us a single stochastic realisation of the model, which is
of limited interest. As an alternative, we can generate a large number
of replicates using arrays for each compartment:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_sir_model_s_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/discrete_stochastic_sir_arrays.R"</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">"odin"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Core equations for transitions between compartments:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">S</span><span class="op">[</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">S</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">n_SI</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">I</span><span class="op">[</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">n_SI</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="va">n_IR</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">R</span><span class="op">[</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">R</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">n_IR</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Individual probabilities of transition:</span></span>
<span><span class="va">p_SI</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta</span> <span class="op">*</span> <span class="va">I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">p_IR</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">gamma</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Draws from binomial distributions for numbers changing between</span></span>
<span><span class="co">## compartments:</span></span>
<span><span class="va">n_SI</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">S</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">p_SI</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">n_IR</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">p_IR</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Total population size</span></span>
<span><span class="va">N</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">S</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">I</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">R</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Initial states:</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">S</span><span class="op">[</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">S_ini</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">I</span><span class="op">[</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">I_ini</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">R</span><span class="op">[</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co">## User defined parameters - default in parentheses:</span></span>
<span><span class="va">S_ini</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">I_ini</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Number of replicates</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nsim</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nsim</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nsim</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nsim</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">p_SI</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nsim</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">n_SI</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nsim</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">n_IR</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">nsim</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_s_a_generator</span> <span class="op">&lt;-</span> <span class="fu">odin</span><span class="fu">::</span><span class="fu"><a href="../reference/odin.html">odin</a></span><span class="op">(</span><span class="va">path_sir_model_s_a</span><span class="op">)</span></span>
<span><span class="va">sir_s_a_generator</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;odin_model&gt; object generator</span></span>
<span><span class="co">##   Public:</span></span>
<span><span class="co">##     initialize: function (..., user = list(...), use_dde = FALSE, unused_user_action = NULL) </span></span>
<span><span class="co">##     ir: function () </span></span>
<span><span class="co">##     set_user: function (..., user = list(...), unused_user_action = NULL) </span></span>
<span><span class="co">##     initial: function (step) </span></span>
<span><span class="co">##     rhs: function (step, y) </span></span>
<span><span class="co">##     update: function (step, y) </span></span>
<span><span class="co">##     contents: function () </span></span>
<span><span class="co">##     transform_variables: function (y) </span></span>
<span><span class="co">##     engine: function () </span></span>
<span><span class="co">##     run: function (step, y = NULL, ..., use_names = TRUE) </span></span>
<span><span class="co">##   Private:</span></span>
<span><span class="co">##     ptr: NULL</span></span>
<span><span class="co">##     use_dde: NULL</span></span>
<span><span class="co">##     odin: NULL</span></span>
<span><span class="co">##     variable_order: NULL</span></span>
<span><span class="co">##     output_order: NULL</span></span>
<span><span class="co">##     n_out: NULL</span></span>
<span><span class="co">##     ynames: NULL</span></span>
<span><span class="co">##     interpolate_t: NULL</span></span>
<span><span class="co">##     cfuns: list</span></span>
<span><span class="co">##     dll: discrete.stochastic.sir.arraysbbe58d63</span></span>
<span><span class="co">##     user: beta gamma I_ini nsim S_ini</span></span>
<span><span class="co">##     registration: function () </span></span>
<span><span class="co">##     set_initial: function (step, y, use_dde) </span></span>
<span><span class="co">##     update_metadata: function () </span></span>
<span><span class="co">##   Parent env: &lt;environment: namespace:discrete.stochastic.sir.arraysbbe58d63&gt;</span></span>
<span><span class="co">##   Locked objects: TRUE</span></span>
<span><span class="co">##   Locked class: FALSE</span></span>
<span><span class="co">##   Portable: TRUE</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">sir_s_a_generator</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sir_col_transp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sir_col</span>, <span class="st">"66"</span><span class="op">)</span></span>
<span><span class="va">x_res</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.1</span>, <span class="fl">5.1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">x_res</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">x_res</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Number of individuals"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sir_col_transp</span>, each <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"left"</span>, lwd <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">sir_col</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="discrete_files/figure-html/sir-stochastic_100-1.png" alt="&lt;i&gt;100 replicates of a stochastic, discrete-time SIR model&lt;/i&gt;&lt;br&gt;" width="672"><p class="caption">
<i>100 replicates of a stochastic, discrete-time SIR model</i><br></p>
</div>
</div>
<div class="section level3">
<h3 id="a-stochastic-seirds-model">A stochastic SEIRDS model<a class="anchor" aria-label="anchor" href="#a-stochastic-seirds-model"></a>
</h3>
<p>This model is a more complex version of the previous one, which we
will use to illustrate the use of all distributions mentioned in the
first part: Binomial, Poisson and Multinomial.</p>
<p>The model is contains the following compartments:</p>
<ul>
<li>
<span class="math inline">\(S\)</span>: susceptibles</li>
<li>
<span class="math inline">\(E\)</span>: exposed, i.e. infected but
not yet contagious</li>
<li>
<span class="math inline">\(I_R\)</span>: infectious who will
survive</li>
<li>
<span class="math inline">\(I_D\)</span>: infectious who will
die</li>
<li>
<span class="math inline">\(R\)</span>: recovered</li>
<li>
<span class="math inline">\(D\)</span>: dead</li>
</ul>
<p>There are no birth of natural death processes in this model.
Parameters are:</p>
<ul>
<li>
<span class="math inline">\(\beta\)</span>: rate of infection</li>
<li>
<span class="math inline">\(\delta\)</span>: rate at which symptoms
appear (i.e inverse of mean incubation period)</li>
<li>
<span class="math inline">\(\gamma_R\)</span>: recovery rate</li>
<li>
<span class="math inline">\(\gamma_D\)</span>: death rate</li>
<li>
<span class="math inline">\(\mu\)</span>: case fatality ratio
(proportion of cases who die)</li>
<li>
<span class="math inline">\(\epsilon\)</span>: import rate of
infected individuals (applies to <span class="math inline">\(E\)</span>
and <span class="math inline">\(I\)</span>)</li>
<li>
<span class="math inline">\(\omega\)</span>: rate waning
immunity</li>
</ul>
<p>The model will be written as:</p>
<p><span class="math display">\[
S_{t+1} = S_t - \beta \frac{S_t (I_{R,t} + I_{D,t})}{N_t} + \omega R_t
\]</span></p>
<p><span class="math display">\[
E_{t+1} = E_t + \beta \frac{S_t (I_{R,t} + I_{D,t})}{N_t} - \delta E_t +
\epsilon
\]</span></p>
<p><span class="math display">\[
I_{R,t+1} = I_{R,t} + \delta (1 - \mu) E_t - \gamma_R I_{R,t} + \epsilon
\]</span></p>
<p><span class="math display">\[
I_{D,t+1} = I_{D,t} + \delta \mu E_t - \gamma_D I_{D,t} + \epsilon
\]</span></p>
<p><span class="math display">\[
R_{t+1} = R_t + \gamma_R I_{R,t} - \omega R_t
\]</span></p>
<p><span class="math display">\[
D_{t+1} = D_t + \gamma_D I_{D,t}
\]</span></p>
<p>The formulation of the model in <code>odin</code> is:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_seirds_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/discrete_stochastic_seirds.R"</span>,</span>
<span>                                 package <span class="op">=</span> <span class="st">"odin"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Core equations for transitions between compartments:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op">-</span> <span class="va">n_SE</span> <span class="op">+</span> <span class="va">n_RS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">E</span> <span class="op">+</span> <span class="va">n_SE</span> <span class="op">-</span> <span class="va">n_EI</span> <span class="op">+</span> <span class="va">n_import_E</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">Ir</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Ir</span> <span class="op">+</span> <span class="va">n_EIr</span> <span class="op">-</span> <span class="va">n_IrR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">Id</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Id</span> <span class="op">+</span> <span class="va">n_EId</span> <span class="op">-</span> <span class="va">n_IdD</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">R</span> <span class="op">+</span> <span class="va">n_IrR</span> <span class="op">-</span> <span class="va">n_RS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">D</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">D</span> <span class="op">+</span> <span class="va">n_IdD</span></span>
<span></span>
<span><span class="co">## Individual probabilities of transition:</span></span>
<span><span class="va">p_SE</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta</span> <span class="op">*</span> <span class="va">I</span> <span class="op">/</span> <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">p_EI</span> <span class="op">&lt;-</span>  <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">delta</span><span class="op">)</span></span>
<span><span class="va">p_IrR</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">gamma_R</span><span class="op">)</span> <span class="co"># Ir to R</span></span>
<span><span class="va">p_IdD</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">gamma_D</span><span class="op">)</span> <span class="co"># Id to d</span></span>
<span><span class="va">p_RS</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">omega</span><span class="op">)</span> <span class="co"># R to S</span></span>
<span></span>
<span></span>
<span><span class="co">## Draws from binomial distributions for numbers changing between</span></span>
<span><span class="co">## compartments:</span></span>
<span><span class="va">n_SE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">p_SE</span><span class="op">)</span></span>
<span><span class="va">n_EI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">E</span>, <span class="va">p_EI</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_EIrId</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="va">n_EI</span>, <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">mu</span></span>
<span><span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">n_EIrId</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">n_EIr</span> <span class="op">&lt;-</span> <span class="va">n_EIrId</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">n_EId</span> <span class="op">&lt;-</span> <span class="va">n_EIrId</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">n_IrR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">Ir</span>, <span class="va">p_IrR</span><span class="op">)</span></span>
<span><span class="va">n_IdD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">Id</span>, <span class="va">p_IdD</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_RS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">R</span>, <span class="va">p_RS</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_import_E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">epsilon</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Total population size, and number of infecteds</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="va">Ir</span> <span class="op">+</span> <span class="va">Id</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op">+</span> <span class="va">E</span> <span class="op">+</span> <span class="va">I</span> <span class="op">+</span> <span class="va">R</span> <span class="op">+</span> <span class="va">D</span></span>
<span></span>
<span><span class="co">## Initial states</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">S_ini</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">E</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">E_ini</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">Id</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">Ir</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">D</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co">## User defined parameters - default in parentheses:</span></span>
<span><span class="va">S_ini</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span> <span class="co"># susceptibles</span></span>
<span><span class="va">E_ini</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># infected</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span> <span class="co"># infection rate</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span> <span class="co"># inverse incubation</span></span>
<span><span class="va">gamma_R</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.08</span><span class="op">)</span> <span class="co"># recovery rate</span></span>
<span><span class="va">gamma_D</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.12</span><span class="op">)</span> <span class="co"># death rate</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span> <span class="co"># CFR</span></span>
<span><span class="va">omega</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.01</span><span class="op">)</span> <span class="co"># rate of waning immunity</span></span>
<span><span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fu">user</span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span> <span class="co"># import case rate</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seirds_generator</span> <span class="op">&lt;-</span> <span class="fu">odin</span><span class="fu">::</span><span class="fu"><a href="../reference/odin.html">odin</a></span><span class="op">(</span><span class="va">path_seirds_model</span><span class="op">)</span></span>
<span><span class="va">seirds_generator</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;odin_model&gt; object generator</span></span>
<span><span class="co">##   Public:</span></span>
<span><span class="co">##     initialize: function (..., user = list(...), use_dde = FALSE, unused_user_action = NULL) </span></span>
<span><span class="co">##     ir: function () </span></span>
<span><span class="co">##     set_user: function (..., user = list(...), unused_user_action = NULL) </span></span>
<span><span class="co">##     initial: function (step) </span></span>
<span><span class="co">##     rhs: function (step, y) </span></span>
<span><span class="co">##     update: function (step, y) </span></span>
<span><span class="co">##     contents: function () </span></span>
<span><span class="co">##     transform_variables: function (y) </span></span>
<span><span class="co">##     engine: function () </span></span>
<span><span class="co">##     run: function (step, y = NULL, ..., use_names = TRUE) </span></span>
<span><span class="co">##   Private:</span></span>
<span><span class="co">##     ptr: NULL</span></span>
<span><span class="co">##     use_dde: NULL</span></span>
<span><span class="co">##     odin: NULL</span></span>
<span><span class="co">##     variable_order: NULL</span></span>
<span><span class="co">##     output_order: NULL</span></span>
<span><span class="co">##     n_out: NULL</span></span>
<span><span class="co">##     ynames: NULL</span></span>
<span><span class="co">##     interpolate_t: NULL</span></span>
<span><span class="co">##     cfuns: list</span></span>
<span><span class="co">##     dll: discrete.stochastic.seirds2b5de612</span></span>
<span><span class="co">##     user: beta delta E_ini epsilon gamma_D gamma_R mu omega S_ini</span></span>
<span><span class="co">##     registration: function () </span></span>
<span><span class="co">##     set_initial: function (step, y, use_dde) </span></span>
<span><span class="co">##     update_metadata: function () </span></span>
<span><span class="co">##   Parent env: &lt;environment: namespace:discrete.stochastic.seirds2b5de612&gt;</span></span>
<span><span class="co">##   Locked objects: TRUE</span></span>
<span><span class="co">##   Locked class: FALSE</span></span>
<span><span class="co">##   Portable: TRUE</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">seirds_generator</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">seirds_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#8c8cd9"</span>, <span class="st">"#e67300"</span>, <span class="st">"#d279a6"</span>, <span class="st">"#ff4d4d"</span>, <span class="st">"#999966"</span>,</span>
<span>                <span class="st">"#660000"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x_res</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.1</span>, <span class="fl">5.1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">x_res</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">x_res</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Number of individuals"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="va">seirds_col</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"left"</span>, lwd <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">seirds_col</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"Ir"</span>, <span class="st">"Id"</span>, <span class="st">"R"</span>, <span class="st">"D"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="discrete_files/figure-html/seirds-1.png" width="672"></p>
<p>Several runs can be obtained without rewriting the model, for
instance, to get 100 replicates:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">x</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x_res</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 366 600</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_res</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    S.1 E.1 Id.1 Ir.1 R.1 D.1  S.2 E.2 Id.2 Ir.2</span></span>
<span><span class="co">## 1 1000   1    0    0   0   0 1000   1    0    0</span></span>
<span><span class="co">## 2 1000   1    0    0   0   0 1000   1    0    0</span></span>
<span><span class="co">## 3 1000   0    0    1   0   0 1000   2    0    0</span></span>
<span><span class="co">## 4 1000   0    0    1   0   0 1000   1    1    0</span></span>
<span><span class="co">## 5 1000   0    0    1   0   0 1000   1    1    0</span></span>
<span><span class="co">## 6 1000   0    0    1   0   0 1000   0    2    0</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seirds_col_transp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">seirds_col</span>, <span class="st">"1A"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.1</span>, <span class="fl">5.1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">365</span>, <span class="va">x_res</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Number of individuals"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">seirds_col_transp</span>, <span class="fl">100</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"right"</span>, lwd <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">seirds_col</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"Ir"</span>, <span class="st">"Id"</span>, <span class="st">"R"</span>, <span class="st">"D"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="discrete_files/figure-html/seirds_100-1.png" alt="&lt;i&gt;100 replicates of a stochastic, discrete-time SEIRDS model&lt;/i&gt;&lt;br&gt;" width="672"><p class="caption">
<i>100 replicates of a stochastic, discrete-time SEIRDS model</i><br></p>
</div>
<p>It is then possible to explore the behaviour of the model using a
simple function:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">50</span>, <span class="va">t</span> <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">365</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.2</span>, <span class="va">...</span>,</span>
<span>                        <span class="va">legend_pos</span> <span class="op">=</span> <span class="st">"topright"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="va">seirds_generator</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">seirds_col</span>, <span class="st">"33"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">model</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">opar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>no.readonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">opar</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.1</span>, <span class="fl">5.1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">res</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">""</span>,  type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>          col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">col</span>, <span class="va">n</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"Number of individuals"</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">3.5</span>, las <span class="op">=</span> <span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="va">legend_pos</span>, lwd <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">seirds_col</span>,</span>
<span>         legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"Ir"</span>, <span class="st">"Id"</span>, <span class="st">"R"</span>, <span class="st">"D"</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This is a sanity check with a null infection rate and no imported
case:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">check_model</span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0</span>, epsilon <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="discrete_files/figure-html/unnamed-chunk-10-1.png" alt="&lt;i&gt;Stochastic SEIRDS model: sanity check with no infections&lt;/i&gt;&lt;br&gt;" width="672"><p class="caption">
<i>Stochastic SEIRDS model: sanity check with no infections</i><br></p>
</div>
<p>Another easy case: no importation, no waning immunity:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">check_model</span><span class="op">(</span>epsilon <span class="op">=</span> <span class="fl">0</span>, omega <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="discrete_files/figure-html/unnamed-chunk-11-1.png" alt="&lt;i&gt;Stochastic SEIRDS model: no importation or waning immunity&lt;/i&gt;&lt;br&gt;" width="672"><p class="caption">
<i>Stochastic SEIRDS model: no importation or waning immunity</i><br></p>
</div>
<p>A more nuanced case: persistence of the disease with limited import,
waning immunity, low severity, larger population:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">check_model</span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span>, epsilon <span class="op">=</span> <span class="fl">0.1</span>, beta <span class="op">=</span> <span class="fl">.2</span>, omega <span class="op">=</span> <span class="fl">.01</span>,</span>
<span>            mu <span class="op">=</span> <span class="fl">0.005</span>, S_ini <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="discrete_files/figure-html/unnamed-chunk-12-1.png" alt="&lt;i&gt;Stochastic SEIRDS model: endemic state in a larger population&lt;/i&gt;&lt;br&gt;" width="672"><p class="caption">
<i>Stochastic SEIRDS model: endemic state in a larger population</i><br></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
